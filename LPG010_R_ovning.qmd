---
format:
  revealjs:
    number-sections: true
    number-depth: 1
    incremental: false
    theme: blood
    margin: 0.01
    smaller: true
    scrollable: true
    slide-number: true
    preview-links: true
    touch: true
echo: true
title: R + RStudio
subtitle: LPG010 (VT26)
institute: Avdelningen f√∂r samh√§llsmedicin och folkh√§lsa
author: Erik B√ºlow
editor: 
  markdown: 
    wrap: 72
---

## R: Programeringsspr√•k

-   `√ñppen k√§llkod`: ("free" as in ...) gratis √∂l üç∫ och yttrandefrihet üì£!

-   **Akademiskt statistikverktyg** üéì (jmfr [SAS](https://www.sas.com/sv_se/home.html) inom l√§kemedelsindustrin üíäüè≠ och [Python](https://www.python.org/) inom "ML/Data science" üë®‚Äçüíª)

-   v\. 1 sl√§pptes üóìÔ∏è 2000-02-29 (utvecklats sedan 1993)

-   Version 4.5.2 ("Eye Holes") sl√§pptes üóìÔ∏è 2025-10-31

-   Interaktivt  skriptspr√•k men ofta kombinerat med `RStudio` (Posit)


::: notes
Gratis √∂l och yttrandefrihet travesterar sloga "free as in free beer and free speach", det vill s√§ga b√•de "gratis" och "fritt" (GNU/GPL etc).
:::

## R: Varifr√•n?

```{r}
print(citation(), bibtex = FALSE)
```

::: notes
Ev kort om R foundation och R Core team (men f√∂rmodligen √∂verkurs)? Att man b√∂r citera eftersom detta √§r enda s√§ttet de f√•r erk√§nnande f√∂r sin insats (inga pengar), samt s√• klart att man i en artikel etc beh√∂ver veta vilken version etc som anv√§nts (eller √§nnu hellre dela kod via Zenodo etc men √∂verkurs).
:::

## R: Varf√∂r?

-  üí™ `Extremt flexibelt`: databearbetning, analys, modellering, visualisering och rapportering

-   üí∞ Gratis och transparent

-   üë®‚Äçüë©‚Äçüëß‚Äçüëß Anv√§ndargrupper ([User groups](https://www.meetup.com/stockholmr/)) och stor hj√§lpsamhet p√• n√§tet

-   L√§tt att dela kod (jmfr. att beskriva manuella GUI-steg)

-   Mogen kodbas som f√∂rb√§ttrats √∂ver tid (utvecklats i > 30 √•r; jmfr t ex [Julia](https://julialang.org/))


## R: Varf√∂r inte?

-   H√∂g inl√§rningstr√∂skel ‚õ∞Ô∏è

-   Kr√§ver att man programmerar[^2] üßë‚Äçüíª

-   Lite annorlunda j√§mf√∂rt med andra programmeringsspr√•k[^3]

-   Finns inget f√∂retag eller dylikt som kan ge officiell support (dock inte s√§mre i praktiken)

[^2]: Finns dock [flera alternativ](https://r4stats.com/articles/software-reviews/r-gui-comparison/) som ocks√• l√§gger p√• ett grafiskt gr√§nssnitt 

[^3]: √ñverkurs: dynamiskt typat, non-standard evaluation ("computing on the language"), funktioner √§r "first class objects" (funktionellt), vektoriserad semantik, copy-on-modify, allt √§r objekt, flera parallella objektorienterade system, designat f√∂r interaktiv analys. 

::: notes
Kan ev n√§mna att trots avsaknaden av f√∂retagsavs√§ndare har valideringar visat att sj√§lva GNU-R har like h√∂g kvalitet som kommersiella motsvarigheter (t ex SAS) och att detta egentligen inte beh√∂ver vara ett hinder ens i f√∂rh√•llande till exempelvis FDA.
:::

## R: N√§r ska du v√§lja R istf SPSS?

-   Om du lockas av programmering üíª

-   Om du ser en framtid inom kvantitativ forskning (doktorera?) üßë‚Äçüî¨

-   Om du vill kunna g√∂ra mer avancerade saker som inte st√∂ds av SPSS

-   Om du vill kunna hantera allt fr√•n databearbetning, till analys och raportering

-   Om din handledare tycker det üòÄ


## RStudio

-   Integrerad utvecklingsmilj√∂ (*Integrated Development Environment; IDE*)

-   Gratis i grundutf√∂rande

-   Fr√•n f√∂retaget [Posit](https://posit.co/) (tidigare RStudio)

-   Public Benefit Corporation ([PBC](https://posit.co/about/pbc-report/))

::: notes
Dags att √∂ppna upp RStudio.

PBC = f√∂retaget vill inte bara tj√§na pengar utan har ett genuint intresse f√∂r anv√§ndarna etc.
:::

## Positron?

- RStudio sl√§pptes f√∂rsta g√•ngen 2011 och bygger nu till viss del p√• gammal teknik
- Uppdateras doock fortfarande och utvecklingen forts√§tter
- Samma f√∂retag har dock mer nyligen sl√§ppt alternativet [Positron](https://positron.posit.co)
- Modernare och bygger p√• en √∂ppen version av VS Code (bekant f√∂r m√•nga programmerare)
- Jobbar du med v√§ldigt stora dataset eller √§r van programmerare sedan tidigare kan vi rekommendera Positron
- F√∂r √∂vriga rekommenderas fortfarande RStuido

## R: Interaktiv anv√§ndning

Kan anv√§ndas som terminalbaserad (mini)r√§knare

```{r}
1 + 1
pi
log(exp(1))
cos(pi) + 42 / 26 - atan(37)
print("Hej p√• dig!")
```

::: notes
RStudio:

1.  Rikta fokus mot konsolen
2.  Exekvera n√•gra enkla saker d√§r (t ex samma som ovan; kopiera via funktionen i presentationen som visas parallellt)
:::

## R: Tilldelning/√•teranv√§ndning

Det som skrivs i konsolen "printas" direkt.

Det man vill spara tilldelas med `<-` (eller `=`)

Kortkommando: Alt/option + "-"

```{r}
x <- 1
x
y <- 2
y
z <- x + y
z
```

Case sensitive (`ABC != abc != Abc != aBc != ‚Ä¶`)

::: notes
Kpoiera och k√∂r i RSTudio samt visa kortkommandot.

Visa √§ven att `X` inte finns (till skillnad fr√•n x.
:::

## R: Datatyper

-   **logical**: `TRUE`, `FALSE`

-   **numeric**: `-23, 2.123, pi`

-   **character**: `"hi", "low"`

-   **Datum**: kan vara lite komplicerat ...

    -   L√§ttast lagra som "character" med format `yyyy-mm-dd` och tolka via `as.Date()`

    -   Anv√§nd paket[^4] s√• som `{clock}` eller `{lubridate}`

[^4]: Vi √•terkommer till vad ett "paket" √§r senare.

::: notes
Kan komplicera saker med referens till integers, floats, doubles etc vilket dyker upp i t ex tidyverse (men inte s√• viktigt i base R). Diskuterades at √§ven ta med faktor men att vi skippar det i detta skede.
:::

## R: Vektorer

```{r}
c(1, 1, 2, 3, 5, 8) # numerisk vektor
c(TRUE, FALSE) # boolsk/logisk vektor
c("hej", "p√•", "dig") # character vector
as.Date(c("1985-05-04", "2023-11-22", "2024-01-26")) # datum
```

## R: Funktioner

-   Funktioner anv√§nds f√∂r att g√∂ra saker med data.

-   Skriver man `namnet_p√•_funktionen` ser man hur den √§r definierad

-   Skriver man parenteser efter s√• anropar man funktionen: `namnet_p√•_funktionen()`

-   De flesta funktioner har ett eller flera argument `namnet_p√•_funktionen(a = x, b = y, c = z)`

-   `?funktionsnamn` i konsolen (eller tryck F1) f√∂r hj√§lp

## R: Exempel: `c()`

Kombinerar/konkatinerar v√§rden till vektorer

```{r}
c
?c
c()
c(1, 2, 3)
```

::: notes
Visa ffa hj√§lpen ?c och f√∂rklara de olika delarna (description, usage, arguments, details, value, exempel etc). Detta b√∂r f√• ta lite tid! Betona att hj√§lpen skrivs av de som g√∂r paketet och att olika "f√∂rfattare" kan t√§nka ganska olika (inte helt standardiserat).
:::

## R: Egna funktioner {visibility="hidden"}

```{r}
function() {} # En namnl√∂s function som inte g√∂r ngt
strunt_funktion <- function() {} # En namngiven funktion som inte g√∂r ngt
strunt_funktion()
hello_world <- function() "Hello world!" # En funktion som h√§lsar
hello_world()
hello_you <- function(who) paste0("Hello ", who, "!")
hello_you("Svenne Banan")
addera <- function(x, y) x + y # funktion som adderar tv√• argument
addera(2, 3)
addera(1:10, 8) # funkar automatiskt med vektorer
addera(Sys.Date(), 1) # Viklen dag √§r det imorgon?
```

## R: Saknade v√§rden

-   Kodas som `NA` (Non Available eller Non Applicable)

-   Funkar oftast att bara skriva just `NA` (inga citationstecken)[^5]

-   Alla datatyper kan vara `NA`

    ```{r}
c(1, 2, NA)
c("banan", NA, "get")
c(TRUE, FALSE, NA)
    ```

[^5]: √ñverkurs: ibland beh√∂ver man g√∂ra skillnad p√• olika sorters `NA` genom att skriva t ex `NA_integer_, NA_character_, NA_real_, ...`

## R: Hantera saknade v√§rden

-   Vad √§r medelv√§rdet av `1, 37, 42`?
    ```{r}
mean(1, 37, 42) # OBS! Gl√∂m inte c(...)
    ```

    ```{r}
mean(c(1, 37, 42))
    ```

-   Vad √§r medelv√§rdet av `1, 37, NA, 42`?

    ```{r}
mean(c(1, 37, NA, 42))
    ```

-   Medelv√§rdet av en samling v√§rden, varav ett ok√§nt, blir f√∂rst√•s ocks√• ok√§nt

-   Hur kan vi hantera detta? Kolla `?mean`

    ```{r}
mean(c(1, 37, NA, 42), na.rm = TRUE)
    ```

## R: Data frame

Datastruktur som liknar Excel-blad eller data i SPSS.

Kolumner best√•r av vektorer av olika sorter.

```{r}
#| eval: false
iris # printa data frame i konsolen
View(iris) # √ñppna en mer grafisk struktur
tail(iris) # titta p√• de sista 6 raderna
str(iris) # f√• information om strukturen
```

```{r}
head(iris, 5) # Visa 5 f√∂rsta raderna
```

::: notes
Visa hur det ser ut i RStudio, ffa View()
:::

## RStudio: Projekt

-   Samla alla filer (data/R-skript/resultat) i projekt-mapp p√• datorn

-   B√§st om s√∂kv√§gen endast best√•r av A-Z/a-z, siffror samt "\_" (undvik √•, √§, √∂ samt mellanslag):

    -   Windows: `C:\User\banane\Documents\nice_project`
    
    -   Mac: `/Users/xbuler/Documents/nice_project`


::: notes
Visa hur man skapar projekt i RStudio i en godtycklig mapp Fokusera p√• "Files"-tabben och att kan √∂ppna filer etc d√§rifr√•n.

P√•peka att det som handlar om s√∂kv√§gar kan vara knepigt att ta in just nu men att det kan bli relevant om man jobbar med eget projekt senare.
:::

## RStudio: Skript

-   B√§st att inte skriva direkt i konsolen utan i en textfil som sparas regelbundet.

-   D√∂p den till `vad_du_vill.R`

-   Allt i skriptet √§r R-kod utom rader som inleds med `#`. Dessa √§r kommentarer till m√§nskliga l√§sare (inkl ditt eget framtida jag).[^6]

[^6]: √ñverkurs: Inte s√• noga med mellanslag/tabbar/radl√§ngder etc i b√∂rjan men at anv√§nda en [stil-guide](https://style.tidyverse.org/) rekommenderas f√∂r st√∂rre projekt! Detta kan automatiseras mha till√§gget [Air](https://posit-dev.github.io/air/editor-rstudio.html).

::: notes
Fokusera nu p√• texteditorn i R.

Visa att man kan skapa ny fil via symbolen uppe till v√§nster.

Att man kan exekvera gm Ctrl/Cmd + Enter

Spara filen som "main.R" i projektet.
:::

## RStudio: Quarto

-   Blanda kommentarer/R-kod/figurer/tabeller i ett och samma dokument

-   Fungerar lite som en vanlig orbehandlare

-   Denna presentation √§r gjord p√• detta s√§tt!

- R+RStudio (med [Quarto](https://quarto.org) + vissa till√§ggspaket) kan helt ers√§tta behovet av MS Word f√∂r rapportskrivning, MS PowerPoint f√∂r presentation och EndNote f√∂r referenshantering

::: notes
Skapa Quarto-dokument. Fyll i via GUI. Exekvera med default-v√§rden.
:::

## R/RStudio: Data

-   Ofta l√§ttast sk√∂ta sj√§lva datainmatningen/f√∂rberedelsen i Excel, SPSS eller annat program.

-   Spara filen i "RStudio-projektet" t ex i en undermapp "data".

-   Importera data via grafiska gr√§nssnittet i RStudio

-   Kopiera genererade inl√§sningskommandon till skriptfilen.

::: notes
Utg√• fr√•n samma fil som anv√§nds i √∂vningen och visa hur man l√§ser in den via Import dataset
:::

## R: S√∂kv√§gar

-   I Windows: Byt ut `\` mot `/`  (alt `\\`) vid referens till fil:

    -   ~~`C:\User\banane\Documents\nice_project`~~
    -   `C:/User/banane/Documents/nice_project`

-   Anv√§nd *relativa* s√∂kv√§gar inom projektet

    -   ~~`C:/User/banane/Documents/nice_project/data/my_data.xlsx`~~
    -   `data/my_data.xlsx`

- t ex: `df <- readxl::read_excel("data/my_data.xlsx")`

## R/RStudio: Paket

-   Alla funktioner (med mera) finns i paket.

-   N√•gra paket kommer f√∂rinstallerade.

-   Detta beh√∂ver man (n√§stan aldrig) t√§nka p√•!

::: notes
Visa Packages-tabben. Inte hur man installerar men att alla paket listas d√§r.
:::

## R: base {visibility="hidden"}

```{r}
?base
ls("package:base")
```

::: notes
Skriv ?base och klicka vidare till index-filen √∂ver alla funktioner. S√∂k inom filen efter "mean" och √∂ppna hj√§lpfilen.
:::

## R: default och recommended {visibility="hidden"}

```{r}
getOption("defaultPackages")
names(which(installed.packages()[, "Priority"] == "recommended", ))
```

::: notes
√ñverkurs: Ut√∂ver base finns n√•gra ytterligare paket med lite s√§rst√§llning som f√∂rinstalleras.
:::

## R: CRAN

-   Kvalitetss√§krade och l√§ttinstallerade till√§ggspaket finns i [The Comprehensive R Archive Network](https://cran.r-project.org/)

-   Installera via grafiskt gr√§nssnit (GUI): Packages \> Install

-   eller kommando: `install.packages("name_of_package")`

::: notes
Visa hur man installerar ett paket via Packages-fliken och Install (exemplifiera med tidyverse)
Skulle √§ven kunna visa hemsidan men gissar att tiden √§r f√∂r knapp.
:::

## Andra paketk√§llor (√∂verkurs) {visibility="hidden"}

-   [GitHub](https://github.com/topics/r) (BitBucket, GitLab)

-   [BioConductor](https://new.bioconductor.org/)

-   [R-forge](https://r-forge.r-project.org/)

-   <https://r-universe.dev/search/>

-   "varsom-helst-ifr√•n" (Zip-filer etc fr√•n hemsidor/kollegor/byr√•l√•dor)

## Anv√§nda funktioner fr√•n installerade paket

-   Installerade paket m√•ste pekas ut explicit vid anv√§ndning:

    -   Ladda hela paketet (rekommenderas i b√∂rjan):
        -   `library("name_of_package")` + sedan `name_of_function(x, y, x)`

    -   Referera varje funktion explicit varje g√•ng:
        -   `name_of_package::name_of_function()`

::: notes
Visa hur det ser ut n√§r man k√∂r library(tidyverse)
:::

##  {background-image="images/SkaÃàrmavbild%202023-11-22%20kl.%2010.52.14.png" background-size="contain"}

## R: Tibble

Delar alla egenskaper med data.frames men lite snyggare/modernare

```{r}
library(tidyverse)
as_tibble(iris)
glimpse(iris)
```

## R: Pipe

`|>` (eller tidigare `%>%`)

```{r eval=FALSE}
# Alt 1: Modifiera ett objekt stegvis med massa nya nammn p√• v√§gen
steg1 <- foo(x)
steg2 <- bar(steg1)
steg3 <- baz(steg2)

# Alt 2: Funktion i funktion i funktion
steg3 <- baz(bar(foo(x)))

# Alt 3: Med |> (l√§ttare att l√§sa och skriva)
steg3 <- x |> foo() |> bar() |> baz()
```

::: notes
Visa kortkommando Ctrl/Cmd + Shift + m

Visa hur man kommer till hj√§lpsidan, kr√§ver ?\`\|\>\` (inkl fnuttar)
:::

## Att l√§ra sig

-   Google √§r din v√§n!

-   √ñvning ger f√§rdighet!

-   <https://www.r-project.org/help.html>

-   <https://education.rstudio.com/learn/>

-   <https://stackoverflow.com/questions/tagged/r>


## Om generativ AI

- ChatGPT etc ger ofta bra hj√§lp f√∂r stabila funktioner fr√•n etablerade paket
- Bygger dock p√• publicerade kod (GitHub, StackOverflow etc)
- En del R-paket utvecklas relativt mycket √∂ver tid
- Detta f√•ngas inte alltid av spr√•kmodellerna (upplevs som hallucinationer)
- Retrieval-Augmented Generation (RAG) kombinerar en generell spr√•kmodell med mer specifik/relevant information
    - [ragnar](https://ragnar.tidyverse.org/index.html)



## √ñverkurs {visibility="hidden"}

Om du programmerat tidigare:

-   interaktivt skriptspr√•k (kr√§ver ingen kompilering)

-   Ej statistik typat (extremt flexibelt men l√§tt att skjuta sig sj√§lv i foten)

-   Nyttjar viss C/C++/Fortran-kod i bakgrunden

> ‚Ä¢ Everything that exists is an object.\
> ‚Ä¢ Everything that happens is a function call."
>
> --- John Chambers
